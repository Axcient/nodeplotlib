"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const opn=require("opn"),express=require("express"),fs_1=require("fs"),path_1=require("path");exports.server={active:!1,loading:!1,instance:null};const app=express(),port=8080;let tempContainer=[];const plotContainer={};function clear(){tempContainer=[]}function stack(e,t){const n=t?{data:e,layout:t}:{data:e};tempContainer.push(n)}function plot(e,t,n){if(e){const n=t?{data:e,layout:t}:{data:e};tempContainer.push(n)}const o=Object.keys(plotContainer).length;plotContainer[o]={opened:!1,pending:!1,plots:tempContainer},tempContainer=[],spawn(()=>{n&&n(o)})}function spawn(e){exports.server.active||exports.server.loading?exports.server.active&&(openPlots(),e()):(exports.server.loading=!0,app.get("/data/:id",(e,t)=>{const n=e.params.id,o=plotContainer[n],r=o&&o.plots;plotContainer[n].opened=!0,plotContainer[n].pending=!1,t.send(r),close()}),app.get("/plots/:id",(e,t)=>{const n=e.params.id;fs_1.readFile(path_1.join(__dirname,"www","index.html"),"utf-8",(e,o)=>{fs_1.readFile(path_1.join(__dirname,"www","script.js"),"utf-8",(e,r)=>(r=r.replace("{{plotId}}",`${n}`),o=o.replace("{{script}}",r),t.send(o)))})}),exports.server.instance=app.listen(port,()=>{exports.server.active=!0,exports.server.loading=!1,openPlots(),e()}))}function openPlots(){for(const e of Object.entries(plotContainer))e[1].opened||e[1].pending||(e[1].pending=!0,opn(`http://localhost:${port}/plots/${e[0]}`))}function close(){const e=Object.values(plotContainer).map(e=>e.pending).reduce((e,t)=>e||t),t=Object.values(plotContainer).map(e=>e.opened).reduce((e,t)=>e&&t);exports.server.instance&&exports.server.active&&!e&&t&&exports.server.instance.close(()=>{exports.server.active=!1})}exports.clear=clear,exports.stack=stack,exports.plot=plot;